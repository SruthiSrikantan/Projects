<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Victoria Agboola and Sruthi Srikantan">

<title>Predicting the Impact of Climate Variability on the Productivity of Key Staple Crops in Niger</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Stat_project_files/libs/clipboard/clipboard.min.js"></script>
<script src="Stat_project_files/libs/quarto-html/quarto.js"></script>
<script src="Stat_project_files/libs/quarto-html/popper.min.js"></script>
<script src="Stat_project_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Stat_project_files/libs/quarto-html/anchor.min.js"></script>
<link href="Stat_project_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Stat_project_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Stat_project_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Stat_project_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Stat_project_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Predicting the Impact of Climate Variability on the Productivity of Key Staple Crops in Niger</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Victoria Agboola and Sruthi Srikantan </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>This project seeks to develop predictive models aimed at forecasting the impact of climate variability on staple crop yields in Sahel Africa. As these crops are vital for Niger and Mali’s agricultural sector and the food security of its population, understanding their future productivity under changing climate conditions is paramount. Leveraging historical climate and agricultural data, the project aims to identify patterns and build models capable of projecting future crop yields under different climate scenarios. The outcomes of this research will contribute to enhancing agricultural policy by providing data insights for crafting farming strategies and policies. Additionally, it will aid in forecasting the potential impact of climate change on food security and livelihoods in the region, ultimately offering a pathway towards bolstering agricultural resilience and ensuring food security in Niger and Mali.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Niger and Mali face significant challenges in sustaining agricultural productivity amidst climate variability and change. The agricultural sector serves as the backbone of Niger’s economy and plays a crucial role in ensuring food security for its population. However, the increasing unpredictability of rainfall patterns and rising temperatures pose substantial threats to the productivity and resilience of these crops.</p>
<p>Recognizing the urgent need to address these challenges, this project aims to develop predictive models to forecast the impact of climate variability on staple crop yields in Niger. By analyzing historical climate data, including temperature and rainfall, in conjunction with agricultural production data such as crop yields, the project seeks to identify patterns and build models capable of projecting future crop yields under various climate scenarios.</p>
<p>Overall, this project represents a critical step towards enhancing agricultural resilience and ensuring food security in Niger and Mali amidst the challenges posed by climate variability and change. By leveraging predictive modeling approaches, it offers a pathway for policymakers, researchers, and stakeholders to collaborate in addressing the complex and interconnected issues of climate change, agriculture, and food security in the region.</p>
</section>
<section id="data-description" class="level2">
<h2 class="anchored" data-anchor-id="data-description">Data Description</h2>
<p><strong>Temp:</strong> annual mean temperature</p>
<p><strong>Raindays:</strong> annual average rain days</p>
<p><strong>Evapotranspiration:</strong> total water loss from both soil evaporation and plant transpiration annually.</p>
<p><strong>Groundfrost_freq:</strong> Annual count of ground surface freezing occurrences.</p>
<p><strong>Diurnal_temp:</strong> Daily temperature variation within a 24-hour period.</p>
<p><strong>Precipitation:</strong> Annual accumulation of water in various forms, such as rain, snow, or hail, over a specified area.</p>
<p><strong>Disaster:</strong> Indicates whether any climate-related disaster occurred in a given year. Assigned a value of 1 if a disaster occurred and 0 if not, covering a range of events such as droughts, infestations, earthquakes, or any other climate-related calamity.</p>
<p><strong>Percent_GDP:</strong> Agriculture, forestry, and fishing, value added (% of GDP)</p>
<p><strong>Percent_working_population:</strong> Age dependency ratio (% of working-age population)</p>
<p><strong>Total_yield:</strong> aggregated annual agricultural yield of staple crops</p>
</section>
<section id="data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h2>
<section id="tidying-of-niger-climate-data" class="level3">
<h3 class="anchored" data-anchor-id="tidying-of-niger-climate-data"><strong>Tidying of Niger Climate Data</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load 'readr' for data import and 'tidyr' for data tidying functions.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In preparing the Niger data for analysis, the initial step was to convert the climate data from its raw form into a tidy format. The raw data, stored in a “.per” file, followed a fixed-width format as specified by the header “format = (i5,17f8.1)”. This format indicated that each line of data contained one 5-character wide integer (the year) and seventeen 8-character wide floating-point numbers (monthly and annual values, with one decimal place).</p>
<p>The `read.fwf` function in R was chosen for its ability to read fixed-width files. This function requires a ‘widths’ argument, which we constructed based on the file’s format specification: a width of 5 for the ‘YEAR’ and widths of 8 for each precipitation value. Only the ‘YEAR’ and ‘ANN’ columns were needed, so the data was subset to these columns after reading.</p>
<p>By executing these steps, we transformed the raw climate data into a tidy data frame with clear, concise columns suitable for subsequent analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># custom function for tidying climate data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>read_climate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path, skip_lines, col_name) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the specified columns from the file</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">read.fwf</span>(file_path, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fu">rep</span>(<span class="dv">8</span>, <span class="dv">17</span>)), </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">skip =</span> skip_lines, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">'YEAR'</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">16</span>), <span class="st">'ANN'</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.strings =</span> <span class="st">'-999.0'</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename the 'ANN' column to the specified climate variable name</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(data)[<span class="fu">names</span>(data) <span class="sc">==</span> <span class="st">'ANN'</span>] <span class="ot">&lt;-</span> col_name</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the dataframe with only 'YEAR' and the specified climate variable</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data[<span class="fu">c</span>(<span class="st">'YEAR'</span>, col_name)])</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To streamline the process of tidying multiple climate data files, a custom R function was created. This function automates the extraction of only the ‘YEAR’ and ‘ANN’ columns from each file, which share a consistent format. By defining the column widths once and applying them across all files, the function efficiently transforms the data into a tidy format, ready for analysis. This approach saves time and ensures consistency in the handling of various datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tmin_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/crucy.v4.07.1901.2022.Niger.tmn.per"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>tmax_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/crucy.v4.07.1901.2022.Niger.tmx.per"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>tmp_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Niger.tmp.per"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>wet_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Niger.wet.per"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>vap_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/crucy.v4.07.1901.2022.Niger.vap.per"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pet_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/crucy.v4.07.1901.2022.Niger.pet.per"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>frs_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Niger.frs.per"</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>dtr_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Niger.dtr.per"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>pre_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Niger.pre.per"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>min_temp <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(tmin_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span><span class="st">"min_temp"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>max_temp <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(tmax_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"max_temp"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(tmp_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"temp"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>raindays <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(wet_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"raindays"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>vapor_pressure <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(vap_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"vapor_pressure"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>evapotranspiration <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(pet_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"evapotranspiration"</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>groundfrost_freq <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(frs_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"groundfrost_freq"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>diurnal_temp <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(dtr_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"diurnal_temp"</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>precipitation <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(pre_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"precipitation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We construct a unified climate dataset by sequentially joining multiple data frames, each holding different climate metrics keyed by ‘YEAR’. The ‘reduce’ function streamlines this merge, resulting in a singular, comprehensive data frame, which we preview with ‘head(climate_data)’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Put all data frames in a list</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>climate_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(min_temp, max_temp, temp, raindays, vapor_pressure, evapotranspiration, groundfrost_freq, diurnal_temp, precipitation)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use reduce from the purrr package to join all data frames</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>climate_data <span class="ot">&lt;-</span> <span class="fu">reduce</span>(climate_data_list, dplyr<span class="sc">::</span>left_join, <span class="at">by =</span> <span class="st">"YEAR"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(climate_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  YEAR min_temp max_temp temp raindays vapor_pressure evapotranspiration
1 1901     19.9     34.7 27.3     20.6           13.4                6.4
2 1902     19.9     34.8 27.3     20.6           13.4                6.4
3 1903     20.0     34.8 27.4     20.6           13.5                6.4
4 1904     20.1     34.7 27.4     20.6           13.5                6.4
5 1905     19.8     34.6 27.2     21.2           13.4                6.4
6 1906     20.0     35.0 27.5     21.0           13.5                6.5
  groundfrost_freq diurnal_temp precipitation
1              0.7         14.8         153.9
2              0.7         14.8         153.8
3              0.7         14.8         153.7
4              0.7         14.7         154.0
5              0.7         14.8         156.3
6              0.7         15.0         165.3</code></pre>
</div>
</div>
</section>
<section id="tidying-niger-historical-extreme-climate-disasters-data" class="level3">
<h3 class="anchored" data-anchor-id="tidying-niger-historical-extreme-climate-disasters-data"><strong>Tidying Niger Historical Extreme Climate Disasters Data</strong></h3>
<p>In preparing the disaster data for analysis, we’re streamlining the information to focus exclusively on Niger from 1901 onwards. We’ll extract the year from the disaster number and keep track of the type of disaster, if any. The aim is to build a clear timeline of years with notable climate events, identifying the presence of critical climate-related disasters such as floods or droughts. This will be distilled into a binary indicator, setting the stage for a focused study on the impacts of climate variability over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load disaster data from the specified Excel file</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>disasters_df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/extreme_climate_data.xlsx"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for Niger, extract the year from 'DisNo.', and select relevant columns</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>niger_disasters_df <span class="ot">&lt;-</span> disasters_df <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Niger"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(<span class="st">`</span><span class="at">DisNo.</span><span class="st">`</span>, <span class="dv">1</span>, <span class="dv">4</span>))) <span class="sc">|&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Year) <span class="sc">&amp;</span> Year <span class="sc">&gt;=</span> <span class="dv">1901</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Year, <span class="at">disaster_type =</span> <span class="st">`</span><span class="at">Disaster Type</span><span class="st">`</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean 'disaster_type' by replacing empty strings with NA</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>niger_disasters_df <span class="ot">&lt;-</span> niger_disasters_df <span class="sc">|&gt;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">disaster_type =</span> <span class="fu">ifelse</span>(disaster_type <span class="sc">==</span> <span class="st">""</span>, <span class="cn">NA</span>, disaster_type))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a tibble of years from 1901 to the most recent year in the Niger data</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>full_years <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Year =</span> <span class="dv">1901</span><span class="sc">:</span><span class="fu">max</span>(<span class="fu">as.numeric</span>(niger_disasters_df<span class="sc">$</span>Year)))</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the complete year sequence with disaster data and sort by year</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>niger_disasters_complete <span class="ot">&lt;-</span> full_years <span class="sc">|&gt;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(niger_disasters_df, <span class="at">by =</span> <span class="st">"Year"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Year)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the complete data frame with all years and disaster types</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(niger_disasters_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
   Year disaster_type
  &lt;dbl&gt; &lt;chr&gt;        
1  1901 &lt;NA&gt;         
2  1902 &lt;NA&gt;         
3  1903 Drought      
4  1904 &lt;NA&gt;         
5  1905 &lt;NA&gt;         
6  1906 Drought      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a binary 'Disaster' column where Yes indicates the presence of Flood, Drought, Infestation, or Storm</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>niger_disasters_complete <span class="ot">&lt;-</span> niger_disasters_complete <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Disaster =</span> <span class="fu">ifelse</span>(disaster_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Flood"</span>, <span class="st">"Drought"</span>, <span class="st">"Infestation"</span>, <span class="st">"Storm"</span>), <span class="st">"Yes"</span>, <span class="st">"No"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Disaster =</span> <span class="fu">ifelse</span>(<span class="fu">any</span>(Disaster <span class="sc">==</span> <span class="st">"Yes"</span>), <span class="st">"Yes"</span>, <span class="st">"No"</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the 'Year' column in niger_disasters_complete to 'YEAR'</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>niger_disasters_complete <span class="ot">&lt;-</span> niger_disasters_complete <span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">YEAR =</span> Year)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Now join with climate_data</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>climate_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(climate_data, niger_disasters_complete, <span class="at">by =</span> <span class="st">"YEAR"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(climate_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  YEAR min_temp max_temp temp raindays vapor_pressure evapotranspiration
1 1901     19.9     34.7 27.3     20.6           13.4                6.4
2 1902     19.9     34.8 27.3     20.6           13.4                6.4
3 1903     20.0     34.8 27.4     20.6           13.5                6.4
4 1904     20.1     34.7 27.4     20.6           13.5                6.4
5 1905     19.8     34.6 27.2     21.2           13.4                6.4
6 1906     20.0     35.0 27.5     21.0           13.5                6.5
  groundfrost_freq diurnal_temp precipitation Disaster
1              0.7         14.8         153.9       No
2              0.7         14.8         153.8       No
3              0.7         14.8         153.7      Yes
4              0.7         14.7         154.0       No
5              0.7         14.8         156.3       No
6              0.7         15.0         165.3      Yes</code></pre>
</div>
</div>
</section>
<section id="tidying-of-agricultural-contribution-to-gdp-data" class="level3">
<h3 class="anchored" data-anchor-id="tidying-of-agricultural-contribution-to-gdp-data"><strong>Tidying of Agricultural Contribution to GDP Data</strong></h3>
<p>In this code block, we load a dataset that captures the agricultural sector’s contribution to Niger’s GDP as a percentage over various years. We clean and reformat this data by focusing on Niger and converting it from a wide format (where each column represents a year) to a long format where each row represents a year and its corresponding GDP percentage. This newly structured data is then merged with the existing climate dataset, enriching it with economic context that may help in analyzing trends and correlations between agricultural economic performance, climate variables and agricultural yield.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load GDP data from a CSV file, skipping the first four rows</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>gdp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/Percent_GDP.csv"</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Niger's GDP data and remove unnecessary columns</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>niger_gdp <span class="ot">&lt;-</span> gdp <span class="sc">|&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country.Code <span class="sc">==</span> <span class="st">"NER"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(Country.Name, Indicator.Name, Indicator.Code))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data from wide to long format, renaming and parsing years</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>tidy_gdp <span class="ot">&lt;-</span> niger_gdp <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>Country.Code,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"YEAR"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"percent_GDP"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YEAR =</span> <span class="fu">parse_number</span>(YEAR)) <span class="sc">|&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(YEAR, percent_GDP)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the GDP data with the existing climate data on the 'YEAR' column</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>climate_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(climate_data, tidy_gdp, <span class="at">by =</span> <span class="st">"YEAR"</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the updated climate data with GDP information</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>climate_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidying-of-percent-working-population-data" class="level3">
<h3 class="anchored" data-anchor-id="tidying-of-percent-working-population-data"><strong>Tidying of Percent Working Population Data</strong></h3>
<p>Here, we handle the integration of demographic data, specifically the percentage of the working-age population in Niger, into our existing climate dataset. Starting by loading and cleaning the data to focus only on relevant metrics, it then transforms the dataset into a long format, aligning the demographic data with corresponding years. This restructuring makes it easier to merge with our climate data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data detailing the percentage of working-age population in Niger over the years, skipping the first four rows.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>percent_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/percent_working_age_population.csv"</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the dataset for records related to Niger, excluding columns that are not relevant to our analysis.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>niger_percent_working_pop <span class="ot">&lt;-</span> percent_pop <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country.Code <span class="sc">==</span> <span class="st">"NER"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(Country.Name, Indicator.Name, Indicator.Code))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data from wide to long format to handle it more easily, assigning 'YEAR' to the years and 'percent_working_population' to the values.</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>tidy_pop <span class="ot">&lt;-</span> niger_percent_working_pop <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>Country.Code,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"YEAR"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"percent_working_population"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YEAR =</span> <span class="fu">parse_number</span>(YEAR)) <span class="sc">|&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(YEAR, percent_working_population)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the first few rows of the processed data to ensure everything is correct.</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tidy_pop)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge this demographic data with the existing climate dataset, matching records by the 'YEAR'.</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>climate_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(climate_data, tidy_pop, <span class="at">by =</span> <span class="st">"YEAR"</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the merged dataset to see the integrated climate and demographic data.</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>climate_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidying-of-agricultural-yield-data" class="level3">
<h3 class="anchored" data-anchor-id="tidying-of-agricultural-yield-data"><strong>Tidying of Agricultural Yield Data</strong></h3>
<p>In this code, we process historical yield data for staple crops in Niger to capture annual agricultural productivity trends. By selecting only ‘Yield’ elements and summarizing these into annual totals, we construct a dataset that focuses on the total agricultural output per year. This data is then merged with an existing climate dataset. By integrating these agricultural yields, we enhance our climate dataset, enabling analyses of how climate variables might correlate with or impact agricultural productivity over time. This comprehensive dataset provides a foundation for exploring interactions between climate conditions and agricultural outputs in Niger.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load historical agricultural yield data for staple crops in Niger.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Yield_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/agricultural_yield_Niger.csv"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for 'Yield' records, aggregate by year, and sum values to get total yield, removing NA values in the process.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>crop_yield <span class="ot">&lt;-</span> Yield_data <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Element <span class="sc">==</span> <span class="st">"Yield"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">|&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_yield =</span> <span class="fu">sum</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, total_yield) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">YEAR =</span> Year)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the yearly total crop yield data to check for correctness.</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crop_yield)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the total crop yield data with the existing climate dataset, matching records by 'YEAR'.</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>climate_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(climate_data, crop_yield, <span class="at">by =</span> <span class="st">"YEAR"</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the updated climate dataset that now includes agricultural yield data.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>climate_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the merged climate data to start from 1961 due to the availability of economic and yield data starting mid-century.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>climate_data_clean <span class="ot">&lt;-</span> climate_data <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">&gt;=</span> <span class="dv">1961</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Country =</span> <span class="st">"Niger"</span>,  <span class="co"># Add a column for country name, placing it before 'total_yield'</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> total_yield) <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(min_temp, max_temp, vapor_pressure))  <span class="co"># Exclude certain climate variables not needed for further analysis</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the 'Disaster' column to numeric where 'Yes' becomes 1, and 'No' or NA becomes 0.</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>climate_data_clean<span class="sc">$</span>Disaster <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(climate_data_clean<span class="sc">$</span>Disaster <span class="sc">==</span> <span class="st">"Yes"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the 'Disaster' numeric column into a factor for categorical analysis.</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>climate_data_clean<span class="sc">$</span>Disaster <span class="ot">&lt;-</span> <span class="fu">factor</span>(climate_data_clean<span class="sc">$</span>Disaster, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the cleaned and filtered climate data.</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(climate_data_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  YEAR temp raindays evapotranspiration groundfrost_freq diurnal_temp
1 1961 26.3     24.4                6.3              2.0         14.9
2 1962 27.1     24.1                6.4              1.2         15.1
3 1963 27.5     22.1                6.5              0.7         15.1
4 1964 27.2     26.1                6.4              0.4         15.0
5 1965 26.8     24.0                6.4              1.0         15.5
6 1966 27.2     22.3                6.4              1.3         15.2
  precipitation Disaster percent_GDP percent_working_population Country
1         213.8        0    73.88717                   99.77513   Niger
2         190.0        0    75.99761                   99.92210   Niger
3         167.2        0    72.94795                  100.59364   Niger
4         227.2        0    74.32404                  101.84330   Niger
5         183.2        0    67.70392                  102.46912   Niger
6         178.2        1    66.87473                  102.25243   Niger
  total_yield
1      117008
2      118428
3      121495
4      124997
5      112383
6      115138</code></pre>
</div>
</div>
<p>When consolidating our comprehensive climate dataset, we encountered a temporal alignment issue: the climate variables began in 1900, while key economic data like percent GDP, working population percentage, and total agricultural yield only started around mid-century. To ensure data consistency and reliability in our analyses, we chose to filter the dataset to start from 1961. This decision, while resulting in the loss of half the original observations, was necessary to maintain a uniform timeline across all variables.</p>
<p>The necessity to filter our dataset to start from 1961 significantly impacted our study’s scope, particularly our objective of analyzing how climate variability affects agricultural productivity. With the data reduced to just 62 rows, the limitations became apparent: such a small sample size restricts the power and reliability of any predictive modeling, potentially skewing insights and undermining the validity of conclusions.</p>
<p>Initially, we considered imputing missing values to reclaim some of the lost data. However, with approximately 40% of our data missing and the issues spanning multiple variables, not just one, this approach risked introducing substantial bias. The complexity of the missingness pattern made reliable imputation unfeasible.</p>
<p>To address these challenges and bolster our analysis, we expanded the geographical scope of our study to include data from Mali, a neighboring country with similar climatic conditions. Integrating the Mali dataset not only enriched our data pool but also provided a broader perspective on the Sahel region’s climate and agricultural patterns. This enhancement allowed us to extend our dataset, enabling more robust and insightful analysis and facilitating the development of a more reliable model for predicting future agricultural yields across the region. This strategic adjustment aims to overcome the limitations posed by the reduced dataset and ensure our research remains both relevant and impactful.</p>
<p>To maintain consistency in our analysis, the same data tidying processes applied to the Niger dataset were also employed for the Mali dataset. Given that the variables and format across both datasets are identical, this ensured a streamlined and uniform approach. We carried out the exact same steps: filtering relevant data, transforming formats where necessary, and summarizing key variables. This meticulous preparation allowed us to seamlessly append the Mali data to our existing dataset. This integration strengthens our dataset, providing a more comprehensive foundation for our predictive modeling and subsequent analysis.</p>
</section>
<section id="tidying-of-mali-climate-data" class="level3">
<h3 class="anchored" data-anchor-id="tidying-of-mali-climate-data">Tidying of Mali Climate Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tmp_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Mali.tmp.per"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>wet_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Mali.wet.per"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>pet_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Mali.pet.per"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>frs_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Mali.frs.per"</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>dtr_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Mali.dtr.per"</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>pre_path <span class="ot">&lt;-</span> <span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/crucy.v4.07.1901.2022.Mali.pre.per"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(tmp_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"temp"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>raindays <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(wet_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"raindays"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>evapotranspiration <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(pet_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"evapotranspiration"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>groundfrost_freq <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(frs_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"groundfrost_freq"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>diurnal_temp <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(dtr_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"diurnal_temp"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>precipitation <span class="ot">&lt;-</span> <span class="fu">read_climate_data</span>(pre_path, <span class="at">skip_lines =</span> <span class="dv">4</span>, <span class="at">col_name =</span> <span class="st">"precipitation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidying-of-historical-climate-disaster-data" class="level3">
<h3 class="anchored" data-anchor-id="tidying-of-historical-climate-disaster-data">Tidying of Historical Climate Disaster Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>disasters_df <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/extreme_climate_data.xlsx"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>mali_disasters_df <span class="ot">&lt;-</span> disasters_df <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Mali"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(<span class="st">`</span><span class="at">DisNo.</span><span class="st">`</span>, <span class="dv">1</span>, <span class="dv">4</span>))) <span class="sc">|&gt;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Year) <span class="sc">&amp;</span> Year <span class="sc">&gt;=</span> <span class="dv">1901</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Year, <span class="at">disaster_type =</span> <span class="st">`</span><span class="at">Disaster Type</span><span class="st">`</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>mali_disasters_df <span class="ot">&lt;-</span> mali_disasters_df <span class="sc">|&gt;</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">disaster_type =</span> <span class="fu">ifelse</span>(disaster_type <span class="sc">==</span> <span class="st">""</span>, <span class="cn">NA</span>, disaster_type))</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a complete sequence of years from 1901 to the most recent year in the data</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>full_years <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Year =</span> <span class="dv">1901</span><span class="sc">:</span><span class="fu">max</span>(<span class="fu">as.numeric</span>(mali_disasters_df<span class="sc">$</span>Year)))</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>mali_disasters_complete <span class="ot">&lt;-</span> full_years <span class="sc">|&gt;</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mali_disasters_df, <span class="at">by =</span> <span class="st">"Year"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Year)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>mali_disasters_complete <span class="ot">&lt;-</span> mali_disasters_complete <span class="sc">|&gt;</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Disaster =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(disaster_type) <span class="sc">&amp;</span> disaster_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Flood"</span>, <span class="st">"Drought"</span>, <span class="st">"Infestation"</span>, <span class="st">"Storm"</span>), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">|&gt;</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Disaster =</span> <span class="fu">max</span>(Disaster, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the 'Year' column in mali_disasters_complete to 'YEAR'</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>mali_disasters_complete <span class="ot">&lt;-</span> mali_disasters_complete <span class="sc">|&gt;</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">YEAR =</span> Year)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mali_disasters_complete)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Now join with climate_data</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>mali_climate_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(mali_climate_data, mali_disasters_complete, <span class="at">by =</span> <span class="st">"YEAR"</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>mali_climate_data <span class="ot">&lt;-</span> mali_climate_data <span class="sc">|&gt;</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Disaster =</span> <span class="fu">replace_na</span>(Disaster, <span class="dv">0</span>))</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mali_climate_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mali-percent-agricultural-contribution-to-gdp-data" class="level3">
<h3 class="anchored" data-anchor-id="mali-percent-agricultural-contribution-to-gdp-data">Mali Percent Agricultural Contribution to GDP Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>gdp<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/Percent_GDP_Mali.csv"</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>mali_gdp <span class="ot">&lt;-</span> gdp <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country.Code <span class="sc">==</span> <span class="st">"MLI"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(Country.Name, Indicator.Name, Indicator.Code))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>tidy_mali <span class="ot">&lt;-</span> mali_gdp <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>Country.Code,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"YEAR"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"percent_GDP"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YEAR =</span> <span class="fu">parse_number</span>(YEAR)) <span class="sc">|&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(YEAR, percent_GDP)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `YEAR = parse_number(YEAR)`.
Caused by warning:
! 1 parsing failure.
row col expected actual
 65  -- a number      X</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tidy_mali)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>mali_climate_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(mali_climate_data, tidy_mali, <span class="at">by =</span> <span class="st">"YEAR"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>mali_climate_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mali-percent-working-age-population-data" class="level3">
<h3 class="anchored" data-anchor-id="mali-percent-working-age-population-data">Mali Percent Working Age Population Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>percent_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/percent_working_age_population_mali.csv"</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>mali_percent_working_pop <span class="ot">&lt;-</span> percent_pop <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country.Code <span class="sc">==</span> <span class="st">"MLI"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(Country.Name, Indicator.Name, Indicator.Code))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>tidy_pop <span class="ot">&lt;-</span> mali_percent_working_pop <span class="sc">|&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>Country.Code,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"YEAR"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"percent_working_population"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YEAR =</span> <span class="fu">parse_number</span>(YEAR)) <span class="sc">|&gt;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(YEAR, percent_working_population)  </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tidy_pop)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>mali_climate_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(mali_climate_data, tidy_pop, <span class="at">by =</span> <span class="st">"YEAR"</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>mali_climate_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mali-historical-agricultural-yield" class="level3">
<h3 class="anchored" data-anchor-id="mali-historical-agricultural-yield">Mali Historical Agricultural Yield</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>Yield_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/Users/victoriaa/Desktop/STAT5125/Project Data/Renamed/final_project/agricultural_yield_Mali.csv"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>crop_yield <span class="ot">&lt;-</span> Yield_data <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Element <span class="sc">==</span> <span class="st">"Yield"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_yield =</span> <span class="fu">sum</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, total_yield) <span class="sc">|&gt;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">YEAR =</span> Year)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crop_yield)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>mali_climate_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(mali_climate_data, crop_yield, <span class="at">by =</span> <span class="st">"YEAR"</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>mali_climate_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mali_climate_data_clean <span class="ot">&lt;-</span> mali_climate_data <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">&gt;=</span> <span class="dv">1961</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Country =</span> <span class="st">"Mali"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> total_yield)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>mali_climate_data_clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the Mali dataset, we applied the same filtering criteria as with the Niger data, starting our analysis from 1961. This alignment was necessary because, similar to Niger, Mali’s data on percent GDP, percent working population, and total yield also begin around mid-century. Imputing data for the earlier missing years was deemed impractical due to the extensive nature of the missingness and the potential biases it could introduce. By filtering the Mali dataset to start in 1961 and integrating it with the Niger dataset, we successfully expanded our pool of observations. This broader dataset enhances our ability to conduct a more robust and comprehensive analysis across the Sahel region, significantly strengthening our research framework.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the cleaned climate data from Niger and Mali into a single dataset</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(climate_data_clean, mali_climate_data_clean) </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Process the 'Disaster' column by converting from factor to numeric, replacing NAs with 0, and optionally converting back to factor</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> combined_df <span class="sc">|&gt;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Disaster =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(Disaster)), <span class="co"># Convert factor to character, then to numeric to handle NAs</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Disaster =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Disaster), <span class="dv">0</span>, Disaster), <span class="co"># Replace any NAs with 0 for consistency</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Disaster =</span> <span class="fu">factor</span>(Disaster)) <span class="co"># Convert back to factor for categorical analysis </span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  YEAR temp raindays evapotranspiration groundfrost_freq diurnal_temp
1 1961 26.3     24.4                6.3              2.0         14.9
2 1962 27.1     24.1                6.4              1.2         15.1
3 1963 27.5     22.1                6.5              0.7         15.1
4 1964 27.2     26.1                6.4              0.4         15.0
5 1965 26.8     24.0                6.4              1.0         15.5
6 1966 27.2     22.3                6.4              1.3         15.2
  precipitation Disaster percent_GDP percent_working_population Country
1         213.8        0    73.88717                   99.77513   Niger
2         190.0        0    75.99761                   99.92210   Niger
3         167.2        0    72.94795                  100.59364   Niger
4         227.2        0    74.32404                  101.84330   Niger
5         183.2        0    67.70392                  102.46912   Niger
6         178.2        1    66.87473                  102.25243   Niger
  total_yield
1      117008
2      118428
3      121495
4      124997
5      112383
6      115138</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(combined_df, <span class="at">file =</span><span class="st">"final_clean_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="missing-data-visualization" class="level3">
<h3 class="anchored" data-anchor-id="missing-data-visualization">Missing Data Visualization</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>combined_df <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vis_dat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="data-exploration" class="level2">
<h2 class="anchored" data-anchor-id="data-exploration">Data Exploration</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats   1.0.0     ✔ lubridate 1.9.3
✔ ggplot2   3.4.3     ✔ stringr   1.5.1
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'scales'

The following object is masked from 'package:purrr':

    discard

The following object is masked from 'package:readr':

    col_factor</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a line plot of agricultural yield over time for both Niger and Mali, with distinct colors for each country</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>combined_df <span class="sc">|&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> YEAR, <span class="at">y =</span> total_yield, <span class="at">group =</span> Country, <span class="at">color =</span> Country)) <span class="sc">+</span>  <span class="co"># Map aesthetics to YEAR and total_yield, grouping and coloring by Country</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>  <span class="co"># Add line geometries to represent trends</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Combined Agricultural Yield Over Time"</span>,  <span class="co"># Set the plot title and subtitles</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Niger and Mali data combined"</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,  </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Yield"</span>,  </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Country"</span>) <span class="sc">+</span>  <span class="co"># Legend title</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(combined_df<span class="sc">$</span>YEAR), <span class="fu">max</span>(combined_df<span class="sc">$</span>YEAR), <span class="at">by =</span> <span class="dv">5</span>))  <span class="co"># Define x-axis breaks every 5 years for readability</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 1: Trends in Agricultural Yield for Niger and Mali from 1961 Onwards</figcaption>
</figure>
</div>
</div>
</div>
<p>In the provided plot, we observe the agricultural yields of Niger and Mali from 1961 onwards. Both countries exhibit an overall upward trend in total yield, reflecting agricultural growth over the decades. Mali’s yields show a steadier, gradual increase, while Niger displays more variability, with sharper inclines and declines. Notably, in recent years, Niger’s yield has seen a significant rise, surpassing Mali’s.</p>
<p>The plot suggests that, while both countries’ agriculture sectors are growing, Niger’s growth has been more pronounced in recent times, possibly due to different agricultural policies, technological adoption, or climatic conditions that may be more favorable to crop production.</p>
<p>Bar Graph for Disaster Frequency: Display the frequency of disasters over the years in a bar graph, overlaying this with a line that shows the trend in crop yield or GDP to suggest the impact of these events.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the climate data to a 0-1 range for better comparison</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> combined_df <span class="sc">|&gt;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(temp, raindays, evapotranspiration), </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span>(. <span class="sc">-</span> <span class="fu">min</span>(.)) <span class="sc">/</span> (<span class="fu">max</span>(.) <span class="sc">-</span> <span class="fu">min</span>(.)), </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">"norm_{.col}"</span>))</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate rolling averages for the normalized data</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> combined_df <span class="sc">|&gt;</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"norm_"</span>), </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">rollapply</span>(., <span class="at">width =</span> <span class="dv">5</span>, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">'right'</span>)))</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot to longer format for plotting</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>climate_long <span class="ot">&lt;-</span> combined_df <span class="sc">|&gt;</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"norm_"</span>), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot with rolling averages</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>climate_rolling_avg_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(climate_long, <span class="fu">aes</span>(<span class="at">x =</span> YEAR,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">y =</span> value, </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Climate Factor Trends with Rolling Averages"</span>,</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Normalized Value (Rolling Average)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"norm_temp"</span> <span class="ot">=</span> <span class="st">"red"</span>, </span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"norm_raindays"</span> <span class="ot">=</span> <span class="st">"blue"</span>, </span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"norm_evapotranspiration"</span> <span class="ot">=</span> <span class="st">"green"</span>)) <span class="sc">+</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify disaster years</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>disaster_years <span class="ot">&lt;-</span> combined_df <span class="sc">|&gt;</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Disaster <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(YEAR)</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a transparent layer for disaster years</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>climate_rolling_avg_plot <span class="ot">&lt;-</span> climate_rolling_avg_plot <span class="sc">+</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> disaster_years, <span class="fu">aes</span>(<span class="at">xintercept =</span> YEAR), </span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the plot</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(climate_rolling_avg_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 2: Five-Year Rolling Averages of Normalized Climate Variables for Niger and Mali. This plot overlays the trends of temperature, raindays, and evapotranspiration, normalized to a 0-1 scale, with disaster years highlighted by dashed lines.</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot presented in the above plot reveals several intriguing patterns in climate factors that might influence agricultural productivity in Niger and Mali. Notably, the temperature shows a subtle but noticeable upward trajectory over the years, hinting at a gradual increase in average temperatures. This could suggest a long-term warming trend, which is consistent with global patterns of climate change and may have profound impacts on regional agriculture, water resources, and ecosystems. In contrast, raindays and evapotranspiration display significant inter-annual variability without a clear long-term trend, reflecting the complexity of precipitation patterns and moisture loss due to factors like evaporation and plant transpiration. The years marked by climate disasters do not immediately correlate with anomalies in the climate data, suggesting that disasters may be linked to extreme, rather than average, conditions or might be driven by additional variables not displayed in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot of total yield versus various climate factors with linear regression lines</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>yield_climate_scatter <span class="ot">&lt;-</span> combined_df <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"ClimateFactor"</span>, <span class="at">value =</span> <span class="st">"Value"</span>, temp, raindays, evapotranspiration) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Value, <span class="at">y =</span> total_yield)) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> ClimateFactor), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span>  <span class="co"># Plot points with semi-transparency for overlap, colored by climate factor</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">color =</span> ClimateFactor), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Add linear regression lines without standard error</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ClimateFactor, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span>  <span class="co"># Create separate plots for each climate factor with their own scales</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># Use a minimal theme for a clean look</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Yield vs. Climate Factors with Regression Line"</span>,  <span class="co"># Add plot title and axis labels</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Yield"</span>, </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Value of Climate Factor"</span>, </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Climate Factor"</span>) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co"># Position the legend at the bottom</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the plot</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(yield_climate_scatter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 3: Relationship between Total Yield and Key Climate Factors with Fitted Linear Regression Lines, illustrating how temperature, raindays, and evapotranspiration correlate with agricultural productivity in the Sahel region.</figcaption>
</figure>
</div>
</div>
</div>
<p>The above plot presents a compelling visualization of how total agricultural yield correlates with several climate variables, which are critical in understanding the agro-climatic dynamics of Niger and Mali. A positive correlation is observed between evapotranspiration and yield, suggesting that conditions leading to higher evapotranspiration, possibly indicating sufficient heat and potential for plant growth, may be beneficial for crop productivity. Conversely, an increased number of raindays seems to inversely affect the yield, potentially highlighting the detrimental impacts of excessive rainfall, such as crop flooding or soil nutrient depletion. Temperature, however, exhibits a nearly flat trend, implying a complex or non-linear relationship with yield, which could indicate the presence of an optimal temperature range for crop growth, outside of which yield may be adversely affected. These relationships underscore the delicate balance between water availability and thermal conditions in securing agricultural output and highlight the importance of nuanced climate-smart agricultural practices in these regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data for the last two decades</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>recent_data <span class="ot">&lt;-</span> combined_df <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">&gt;=</span> <span class="dv">2000</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the correlation matrix</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(recent_data[, <span class="fu">c</span>(<span class="st">"temp"</span>, <span class="st">"raindays"</span>, <span class="st">"evapotranspiration"</span>, <span class="st">"total_yield"</span>, <span class="st">"percent_GDP"</span>, <span class="st">"percent_working_population"</span>)])</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the heatmap</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(correlation_matrix, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, <span class="at">tl.cex =</span> <span class="fl">0.7</span>,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="co"># Add correlation coefficient values</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">number.cex =</span> <span class="fl">0.7</span>, <span class="co"># Font size for correlation coefficient values</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="co"># Color of variable names</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"#FFFFFF"</span>, <span class="st">"#7F7F7F"</span>, <span class="st">"#000000"</span>))(<span class="dv">100</span>), <span class="co"># Color palette</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Correlation Heatmap of Climate, Economic, and Agricultural Variables"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 4: Heatmap showcasing the correlation matrix of climate, economic, and agricultural variables from the last two decades, illustrating the interdependencies between these factors in the Sahel region.</figcaption>
</figure>
</div>
</div>
</div>
<p>The heatmap indicates a strong positive correlation between temperature and raindays. Temperature has a notably strong negative correlation with evapotranspiration. Evapotranspiration and raindays are strongly negatively correlated, implying that as one increases, the other tends to decrease. The climate variables have relatively low to moderate negative correlations with economic indicators, suggesting a more complex and less direct relationship between climate factors and economic conditions. Recognizing the limited strength of these correlations is important, as it highlights the need for a nuanced approach when analyzing the impact of climate on agricultural productivity and the economy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a density plot to examine the distribution and relationship between percent working population and total yield</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>combined_df <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> percent_working_population, <span class="at">y =</span> total_yield)) <span class="sc">+</span>  <span class="co"># Set axes aesthetics</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d_filled</span>(<span class="at">bins=</span><span class="dv">10</span>) <span class="sc">+</span>  <span class="co"># Use 2D density estimation with 10 levels</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Apply a color palette for the fill with reversed Spectral colors</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Country) <span class="sc">+</span>  <span class="co"># Separate plots for each country for comparison</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Percent Working Population"</span>, <span class="at">y =</span> <span class="st">"Total Yield"</span>, <span class="at">title =</span> <span class="st">"Density plot of Percent Working Population by Total Yield"</span>)  <span class="co"># Add labels and title</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 5: Contour-filled density plots displaying the relationship between the percent working population and total agricultural yield for Niger and Mali, visualized separately for each country.</figcaption>
</figure>
</div>
</div>
</div>
<p>The density plot displays the relationship between the percent working population and the total agricultural yield for Mali and Niger. For Niger, the plot shows a pronounced peak, suggesting that there’s a specific range of the working population where yield is maximized. The plot for Mali, however, presents three less distinct peaks, indicating that the relationship between the working population and yield isn’t as clear-cut in Mali as it is in Niger.</p>
<p>The key takeaway from this density plot is that in Niger, there seems to be a sweet spot where the size of the working population correlates with higher yield outcomes, which could imply a more direct impact of labor availability on agricultural productivity. In contrast, Mali’s agricultural yield appears to be influenced by factors beyond just the percent working population, as evidenced by the multiple clusters.</p>
<p>This visual analysis challenges the assumption that a larger workforce consistently translates to higher yields. Instead, it suggests that agricultural productivity may be more complex and possibly influenced by a combination of factors, which might include efficiency, technology, access to resources, and agricultural practices, alongside the workforce size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plotly'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    last_plot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an interactive scatter plot visualizing the relationship between total yield and percent GDP from the year 2000 onwards, with point size representing percent working population and color distinguishing countries</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> combined_df <span class="sc">|&gt;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">&gt;=</span> <span class="dv">2000</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(total_yield, percent_GDP, <span class="at">size =</span> percent_working_population, <span class="at">color =</span> Country)) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  <span class="co"># Create scatter plot points</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span>  <span class="co"># Apply a black and white theme for a clean look</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Total Yield"</span>, <span class="at">y =</span> <span class="st">"Percent GDP"</span>, <span class="at">title =</span> <span class="st">"Interactive plot between Total Yield and Percent GDP"</span>)  <span class="co"># Add labels and title</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 6: Interactive visualization depicting the relationship between total agricultural yield and the percentage of GDP from agriculture in Niger and Mali since 2000, with the size of each point representing the percent of the working population involved in agriculture.</figcaption>
</figure>
</div>
</div>
</div>
<p>The scatter plot visualizes the relationship between total agricultural yield and percent GDP, with the size of the points indicating the percent working population in agriculture for Mali and Niger. For both countries, there appears to be a positive trend, suggesting that as the total yield increases, the percent contribution of agriculture to GDP also rises. The distribution of points for Mali is more concentrated at lower yield levels, whereas Niger’s points are more spread out, indicating a broader range of yield. Larger point sizes are more prevalent for Niger, implying a larger portion of the working population is involved in agriculture compared to Mali. This plot underscores the positive association between agricultural productivity and its economic significance in these countries.</p>
</section>
<section id="data-modeling" class="level2">
<h2 class="anchored" data-anchor-id="data-modeling">Data Modeling</h2>
<p>After tidying our data, creating insightful visualizations, and understanding key trends, we’re now stepping into the regression modeling phase of our project. This stage is crucial as it helps us predict agricultural yields by analyzing a variety of climatic and socio-economic factors.</p>
<p>Here, we prepare our dataset for the regression model. We select specific variables from our combined dataset that we believe influence agricultural yield significantly. This selection includes both environmental factors like temperature and rainfall, and socio-economic factors like the impact of disasters and economic contributions from agriculture. With these variables, we aim to construct a model that can accurately forecast yield based on current and historical data patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> combined_df <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(temp, raindays, evapotranspiration, groundfrost_freq, diurnal_temp, precipitation,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>           Disaster, percent_GDP, percent_working_population, total_yield))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>model_data <span class="sc">|&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 124
Columns: 10
$ temp                       &lt;dbl&gt; 26.3, 27.1, 27.5, 27.2, 26.8, 27.2, 26.9, 2…
$ raindays                   &lt;dbl&gt; 24.4, 24.1, 22.1, 26.1, 24.0, 22.3, 21.2, 2…
$ evapotranspiration         &lt;dbl&gt; 6.3, 6.4, 6.5, 6.4, 6.4, 6.4, 6.4, 6.4, 6.6…
$ groundfrost_freq           &lt;dbl&gt; 2.0, 1.2, 0.7, 0.4, 1.0, 1.3, 1.5, 0.9, 0.6…
$ diurnal_temp               &lt;dbl&gt; 14.9, 15.1, 15.1, 15.0, 15.5, 15.2, 14.7, 1…
$ precipitation              &lt;dbl&gt; 213.8, 190.0, 167.2, 227.2, 183.2, 178.2, 1…
$ Disaster                   &lt;fct&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0…
$ percent_GDP                &lt;dbl&gt; 73.88717, 75.99761, 72.94795, 74.32404, 67.…
$ percent_working_population &lt;dbl&gt; 99.77513, 99.92210, 100.59364, 101.84330, 1…
$ total_yield                &lt;dbl&gt; 117008, 118428, 121495, 124997, 112383, 115…</code></pre>
</div>
</div>
<p>We import the default settings for the <strong><code>tidymodels</code></strong> suite.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We ensure consistency in our results by setting a seed, which allows for the reproducibility of our analysis. We then divide the data into training and testing sets, allocating 80% to training, to prepare for the development of our regression model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>data_split <span class="ot">&lt;-</span> model_data <span class="sc">|&gt;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">initial_split</span>(<span class="at">prop=</span><span class="fl">0.8</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>data_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;99/25/124&gt;</code></pre>
</div>
</div>
<p>Following the data split, we extract the training subset to develop our model and the testing subset to evaluate its performance later. This step is crucial for ensuring that our model learns to predict accurately while also being able to generalize well to new, unseen data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> data_split <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">training</span>()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> data_split <span class="sc">|&gt;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">testing</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="validation-split" class="level3">
<h3 class="anchored" data-anchor-id="validation-split"><strong>Validation split</strong></h3>
<p>We reset the seed to ensure reproducibility before creating a 10-fold cross-validation setup with our training data. This method helps in assessing the model’s stability and performance by partitioning the data into 10 subsets, allowing the model to train and validate across multiple scenarios. We then check the class of our cross-validation object to confirm its structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>vfold_set <span class="ot">&lt;-</span> train_data <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vfold_cv</span>(<span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>vfold_set <span class="sc">|&gt;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "vfold_cv"   "rset"       "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
</section>
<section id="defining-model-workflow" class="level3">
<h3 class="anchored" data-anchor-id="defining-model-workflow"><strong>Defining Model Workflow</strong></h3>
<p>We initiate the modeling phase by defining several predictive models using different algorithms to evaluate their effectiveness in forecasting agricultural yields:</p>
<ol type="1">
<li><p><strong>Linear Regression Model</strong>: We configure a simple linear regression model using the least squares method, setting it specifically for regression tasks.</p></li>
<li><p><strong>Lasso Regression Model</strong>: We define a Lasso regression model, incorporating a penalty term to encourage sparsity and potentially improve model performance on predictors with significant multicollinearity.</p></li>
<li><p><strong>Random Forest Model</strong>: A random forest regressor is set up using the ‘ranger’ package, chosen for its robustness and effectiveness in handling non-linear relationships without extensive hyperparameter tuning.</p></li>
<li><p><strong>K-Nearest Neighbors Model</strong>: We configure a k-nearest neighbors model using the ‘kknn’ library, specifying three neighbors to predict outcomes based on the average response of the nearest data points, tailored for regression.</p></li>
<li><p><strong>Decision Tree Regressor</strong>: We employ a decision tree model configured with the ‘rpart’ engine, favored for its interpretability and suitability in capturing non-linear patterns and interactions between variables without the need for extensive data scaling or transformation.</p></li>
</ol>
<p>These diverse approaches allow us to compare methods and determine the most accurate and reliable model for predicting agricultural yields based on our dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>linear_fit <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fl">0.01</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kknn)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>knn_fit <span class="ot">&lt;-</span> <span class="fu">nearest_neighbor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>, </span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">neighbors =</span> <span class="dv">3</span>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>tree_fit <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We construct two distinct recipes for preprocessing our training data, both aimed at predicting <strong><code>total_yield</code></strong>, but tailored for different modeling needs:</p>
<p><strong>Model Recipe 1</strong>:</p>
<ol type="1">
<li><p><strong>Normalization</strong>: We apply normalization to all numeric predictors to ensure that the model isn’t biased by the scale of the variables, which enhances the stability and performance of the algorithms suited for such preprocessing, like linear and lasso regression.</p></li>
<li><p><strong>Imputation</strong>: Median imputation is employed for the <strong><code>percent_GDP</code></strong> variable to address any missing values, which helps maintain robustness in our predictions by using a central tendency measure that is less affected by outliers.</p></li>
<li><p><strong>Encoding</strong>: We convert all nominal predictors into dummy variables, which allows our regression models to incorporate these categorical variables by treating them as a series of binary inputs.</p></li>
</ol>
<p><strong>Model Recipe 2</strong> (Specifically for Decision Tree):</p>
<ol type="1">
<li><p><strong>Imputation</strong>: As with the first recipe, median imputation for <strong><code>percent_GDP</code></strong> addresses missing data, essential for maintaining complete records for modeling.</p></li>
<li><p><strong>Encoding</strong>: We continue to encode nominal predictors into dummy variables to facilitate the decision tree’s handling of categorical data, despite removing the normalization step, as decision trees inherently manage varying scales of numerical data.</p></li>
</ol>
<p>This structured approach in preprocessing ensures that the data fed into the models is clean, appropriately formatted, and ready for effective analysis, with each recipe customized to optimize the respective model’s performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>model_recipe_1 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(total_yield <span class="sc">~</span> .,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data=</span>train_data)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>model_recipe_1 <span class="ot">&lt;-</span> model_recipe_1 <span class="sc">|&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(percent_GDP) <span class="sc">|&gt;</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>model_recipe_2 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(total_yield <span class="sc">~</span> .,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data=</span>train_data)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>model_recipe_2 <span class="ot">&lt;-</span> model_recipe_2 <span class="sc">|&gt;</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(percent_GDP) <span class="sc">|&gt;</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Workflow 1</strong></p>
<p>We set up a workflow for the Decision Tree model that uses <strong><code>model_recipe_2</code></strong>, optimized for decision trees. This workflow integrates our decision tree configured with the <strong><code>rpart</code></strong> engine and the preprocessing recipe tailored for non-normalized data. It focuses on median imputation and dummy encoding to prepare our data effectively for the model, ensuring it captures the essential patterns without the interference of scaling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>tree_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(tree_fit) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(model_recipe_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Workflow 2</strong></p>
<p>We further refine our approach by constructing a second workflow for the linear regression model, focusing on a subset of predictors:</p>
<p>1. <strong>Workflow Setup</strong>: A new workflow is initiated, maintaining the linear regression model from before.</p>
<p>2. <strong>Formula Specification</strong>: In this workflow, the formula for predicting `total_yield` is explicitly defined to include only key climatic variables: temperature (`temp`), number of rainy days (`raindays`), evapotranspiration, and total precipitation.</p>
<p>This targeted approach allows us to assess the impact of specific climatic factors on agricultural yield, providing insights into their direct relationships and potential predictability within the model framework.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>lm_workflow_2 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(linear_fit) <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(total_yield <span class="sc">~</span> temp <span class="sc">+</span> raindays <span class="sc">+</span> evapotranspiration <span class="sc">+</span> precipitation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Workflow 3</strong></p>
<p>We configure another workflow for the linear regression model, incorporating `model_recipe_1`. This setup uses a comprehensive preprocessing recipe that includes normalization of numeric predictors, median imputation for missing data, and dummy encoding of categorical variables, ensuring the data is optimally prepared for regression analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>lm_workflow_3 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(linear_fit) <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(model_recipe_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Workflow 4</strong></p>
<p>We establish a workflow for the Lasso regression model, utilizing `model_recipe_1`. This workflow aligns our Lasso model with a preprocessing recipe that normalizes numeric predictors, imputes missing values with medians, and encodes categorical variables, preparing the data to effectively manage multicollinearity and enhance model performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>lasso_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span> () <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_fit) <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(model_recipe_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Workflow 5</strong></p>
<p>We’ve craft a workflow for the Random Forest model by pairing it with `model_recipe_1`. This combination ensures the model benefits from normalized numeric predictors, median-imputed missing values, and dummy-encoded categorical variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>rf_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_fit) <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(model_recipe_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Workflow 6</strong></p>
<p>We set up a workflow for the K-Nearest Neighbors model, incorporating `model_recipe_1` to ensure the data is appropriately preprocessed for regression analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>knn_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(knn_fit) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(model_recipe_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-selection-assessment" class="level2">
<h2 class="anchored" data-anchor-id="model-selection-assessment">Model Selection &amp; Assessment</h2>
<p>In this section, we evaluate and compare the performance of our various predictive models to select the most effective one for accurately forecasting agricultural yields, ensuring our choice is well-informed by a thorough analysis of each model’s accuracy and robustness.</p>
<p>We create a vector `workflow_names` which labels our diverse modeling workflows: decision tree, linear regression with interactions, linear regression with preprocessing steps, lasso regression, random forest, and k-nearest neighbors. This organization aids in efficiently managing and referencing these workflows throughout our analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>workflow_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tree"</span>,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"lm_interactions"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"lm_steps"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"lasso"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"rf"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"knn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We compile a list `workflow_objects` containing the workflows for decision tree, linear regression variants, lasso, random forest, and k-nearest neighbors, streamlining model evaluation and selection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>workflow_objects <span class="ot">&lt;-</span> <span class="fu">list</span>(tree_workflow,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                         lm_workflow_2,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                         lm_workflow_3,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                         lasso_workflow,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                         rf_workflow,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                         knn_workflow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We create a `tibble` named `workflows_tbl` that pairs workflow names with their corresponding objects, organizing them into a structured table format. This setup facilitates easier access and management of the various modeling workflows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>workflows_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">work_names =</span> workflow_names,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">work_objects =</span> workflow_objects)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>workflows_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  work_names      work_objects
  &lt;chr&gt;           &lt;list&gt;      
1 tree            &lt;workflow&gt;  
2 lm_interactions &lt;workflow&gt;  
3 lm_steps        &lt;workflow&gt;  
4 lasso           &lt;workflow&gt;  
5 rf              &lt;workflow&gt;  
6 knn             &lt;workflow&gt;  </code></pre>
</div>
</div>
<p>We initialize a controlled random seed for reproducibility and define a set of prediction metrics including RMSE, R-squared, MAPE, and MAE using the `yardstick` package. We then enhance the `workflows_tbl` by applying model fitting across 10-fold cross-validation sets for each workflow, storing the fit results. Subsequently, we extract and store the performance metrics from these results, organizing everything in a structured `tibble` for comprehensive model evaluation and comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>prediction_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                          rsq, </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                          yardstick<span class="sc">::</span>mape,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                          yardstick<span class="sc">::</span>mae)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>workflows_tbl <span class="ot">&lt;-</span> workflows_tbl <span class="sc">|&gt;</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fits=</span> <span class="fu">list</span>(<span class="fu">fit_resamples</span>(work_objects, </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                       vfold_set,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">metrics=</span>prediction_metrics))) <span class="sc">|&gt;</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">results =</span> <span class="fu">list</span>(<span class="fu">collect_metrics</span>(fits)))</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>workflows_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Rowwise: 
  work_names      work_objects fits      results         
  &lt;chr&gt;           &lt;list&gt;       &lt;list&gt;    &lt;list&gt;          
1 tree            &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt;
2 lm_interactions &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt;
3 lm_steps        &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt;
4 lasso           &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt;
5 rf              &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt;
6 knn             &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt;</code></pre>
</div>
</div>
<p>We refine `workflows_tbl` to focus on the model names and their respective performance metrics by selecting and unnesting the results. This produces `workflows_result_tbl`, a streamlined table that directly presents the evaluation metrics for each model, facilitating an easy comparison of their predictive accuracy and effectiveness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>workflows_result_tbl <span class="ot">&lt;-</span> workflows_tbl <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(work_names, </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>         results) <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(results)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>workflows_result_tbl </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 7
   work_names      .metric .estimator      mean     n   std_err .config         
   &lt;chr&gt;           &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;           
 1 tree            mae     standard   31813.       10 4905.     Preprocessor1_M…
 2 tree            mape    standard      20.3      10    3.59   Preprocessor1_M…
 3 tree            rmse    standard   43756.       10 6508.     Preprocessor1_M…
 4 tree            rsq     standard       0.564    10    0.0780 Preprocessor1_M…
 5 lm_interactions mae     standard   30191.       10 3995.     Preprocessor1_M…
 6 lm_interactions mape    standard      20.3      10    1.51   Preprocessor1_M…
 7 lm_interactions rmse    standard   38176.       10 5823.     Preprocessor1_M…
 8 lm_interactions rsq     standard       0.656    10    0.0482 Preprocessor1_M…
 9 lm_steps        mae     standard   30668.       10 3295.     Preprocessor1_M…
10 lm_steps        mape    standard      21.0      10    1.15   Preprocessor1_M…
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>We apply a visualization to compare the performance of each model using the `ggplot` package. The plot arranges metrics such as RMSE, R-squared, MAPE, and MAE horizontally, with each bar representing the mean metric value for a workflow, differentiated by color. The metrics are separated into distinct panels using `facet_wrap`, each with its own x-axis, to clearly display how each model performs under different evaluative criteria. This approach aids in identifying the most effective model based on the aggregated results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bar plot to display the average metric scores for different workflows</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>workflows_result_tbl <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> work_names, <span class="at">x =</span> mean, <span class="at">fill =</span> work_names)) <span class="sc">+</span>  <span class="co"># Map the mean metric values to the x-axis and the workflow names to the y-axis and color</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span>  <span class="co"># Use columns to represent the data</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric, <span class="at">scales =</span> <span class="st">"free_x"</span>)  <span class="co"># Separate the plot into facets for each metric and allow each to have its own x-axis scale</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 7: Average performance metrics across various modeling workflows, with each model’s mean score depicted by bars and facetted by the metric type to allow comparison within each category of assessment.</figcaption>
</figure>
</div>
</div>
</div>
<p>Based on the visualization, the Random Forest model stands out as the top performer among all the models evaluated. It consistently achieves the lowest values for RMSE, MAPE, and MAE, indicating superior predictive accuracy and reliability compared to other models. Additionally, the Random Forest model demonstrates a relatively high R-squared value, suggesting strong explanatory power in capturing the variance of the target variable.</p>
<p>Therefore, the Random Forest model emerges as the most suitable choice for predicting agricultural yields in this dataset. Its ability to handle complex relationships, manage multicollinearity, and deliver consistently accurate forecasts makes it the preferred option for practical applications.</p>
<p>While the Random Forest model excels in performance, it’s also essential to acknowledge the competitive performance of other models. For example, the Decision Tree model showcases competitive accuracy but falls short in terms of overall performance compared to Random Forest. Linear regression models, both with and without interaction terms, provide acceptable results but exhibit higher error metrics compared to Random Forest, indicating a less precise prediction of agricultural yields.</p>
<p>In summary, while several models show promising performance, the Random Forest model emerges as the optimal choice for accurately predicting agricultural yields based on the dataset’s characteristics and evaluation criteria.</p>
<p>We update `workflows_tbl` to include predictions on the test data for each model. This involves fitting each model to the training data and then making predictions on the test data. The resulting table now contains a new column `predictions` that stores the predictions for each model on the test data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>workflows_tbl <span class="ot">&lt;-</span> workflows_tbl <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fits2 =</span> <span class="fu">list</span>(<span class="fu">fit</span>(work_objects,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                          train_data))) <span class="sc">|&gt;</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions =</span> <span class="fu">list</span>(<span class="fu">predict</span>(fits2,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                                    test_data)))</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>workflows_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
# Rowwise: 
  work_names      work_objects fits      results          fits2      predictions
  &lt;chr&gt;           &lt;list&gt;       &lt;list&gt;    &lt;list&gt;           &lt;list&gt;     &lt;list&gt;     
1 tree            &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt; &lt;workflow&gt; &lt;tibble&gt;   
2 lm_interactions &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt; &lt;workflow&gt; &lt;tibble&gt;   
3 lm_steps        &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt; &lt;workflow&gt; &lt;tibble&gt;   
4 lasso           &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt; &lt;workflow&gt; &lt;tibble&gt;   
5 rf              &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt; &lt;workflow&gt; &lt;tibble&gt;   
6 knn             &lt;workflow&gt;   &lt;rsmp[+]&gt; &lt;tibble [4 × 6]&gt; &lt;workflow&gt; &lt;tibble&gt;   </code></pre>
</div>
</div>
</section>
<section id="uncertainty-quantification" class="level2">
<h2 class="anchored" data-anchor-id="uncertainty-quantification">Uncertainty Quantification</h2>
<p>We generate a table named `predictions_tbl` that presents the predictions made by each model on the test data alongside the actual values of `total_yield`. This table facilitates a direct comparison between the predicted and actual values, allowing for an assessment of each model’s predictive accuracy on unseen data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>predictions_tbl  <span class="ot">&lt;-</span> workflows_tbl <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(work_names, </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>         predictions) <span class="sc">|&gt;</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(predictions))</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>predictions_tbl <span class="ot">&lt;-</span> predictions_tbl <span class="sc">|&gt;</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">total_yield =</span> test_data <span class="sc">|&gt;</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">pull</span>(total_yield))</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predictions_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  work_names    .pred total_yield
1       tree 203182.2      121495
2       tree 106344.4      124997
3       tree 106344.4      112383
4       tree 106344.4      114399
5       tree 106344.4      102634
6       tree 203182.2      122127</code></pre>
</div>
</div>
<p>This section evaluates the Random Forest model’s performance using the Mean Absolute Error (MAE) metric. It provides a measure of how accurately the model predicts agricultural yields, crucial for assessing its effectiveness in practical applications.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>predictions_tbl <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(work_names <span class="sc">==</span> <span class="st">"rf"</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mae</span>(<span class="at">truth =</span> total_yield, <span class="at">estimate=</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 mae     standard      33573.</code></pre>
</div>
</div>
<p>The scatter plot generated visualizes the relationship between actual and predicted `total_yield` values for each model. Each panel represents a different model, allowing direct comparison of their prediction accuracies. Additionally, a dotted red line denotes perfect predictions, where the predicted value matches the actual value. This visualization offers valuable insights into the models’ performance in predicting agricultural yields.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot actual vs predicted yield for various models, with opacity set for clarity in case of overlapping points</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>predictions_tbl <span class="sc">|&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> total_yield, <span class="at">y =</span> .pred)) <span class="sc">+</span>  <span class="co"># Map actual yield to x-axis and predicted yield to y-axis</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span>  <span class="co"># Plot points with transparency</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>work_names, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Organize plots by model names into 2 rows</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span>  <span class="co"># Add a dotted line with slope=1 for reference</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()  <span class="co"># Use a coordinate system that is optimal for observation vs prediction plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 8: Scatter plots comparing actual and predicted yields for various statistical models, with a red dotted line indicating perfect predictions where actual yields equal predicted yields.</figcaption>
</figure>
</div>
</div>
</div>
<p>Upon reviewing the scatterplot matrix, we observe that the alignment of data points in the Random Forest (rf) panel closely follows the red dotted line which represents the ideal scenario where predicted values match the actual yields. This visual clustering near the line corroborates our previous assessment that the Random Forest model is indeed the most accurate among those evaluated.</p>
<p>In contrast, the Decision Tree, K-Nearest Neighbors (knn) and Lasso Regression (lasso) models show a discernible scatter of points away from the red line. This visual representation echoes our earlier findings, suggesting that these models are less precise in their predictions when compared to the Random Forest model.</p>
<p>In essence, the graphical analysis presented here visually reinforces the conclusion that the Random Forest model holds its ground as the superior predictive tool in this particular analysis.</p>
<section id="random-forest-error-deep-dive" class="level3">
<h3 class="anchored" data-anchor-id="random-forest-error-deep-dive">Random Forest Error Deep Dive</h3>
<p>In the presented scatterplot above, two data points significantly diverge from the anticipated trend line in the Random Forest model’s predictions. This observation prompts a closer investigation of these points to uncover the underlying reasons for this deviation. Understanding whether these are outliers, extreme values, or indicators of a data pattern not captured by the model is essential. This investigation will help ensure the integrity of the model’s predictive power and may provide insights for further refinement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>rf_predictions_tbl <span class="ot">&lt;-</span> predictions_tbl <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(work_names <span class="sc">==</span> <span class="st">"rf"</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">abs_error =</span> <span class="fu">abs</span>(.pred <span class="sc">-</span> total_yield),</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">row_number =</span> <span class="fu">row_number</span>()) </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rf_predictions_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  work_names    .pred total_yield abs_error row_number
1         rf 148436.6      121495 26941.551          1
2         rf 118608.2      124997  6388.798          2
3         rf 135395.8      112383 23012.832          3
4         rf 120250.2      114399  5851.156          4
5         rf 110495.2      102634  7861.240          5
6         rf 198137.3      122127 76010.333          6</code></pre>
</div>
</div>
<p>First, we extract only the Random Forest model predictions from our dataset. We then calculate how much each prediction deviates from the actual yield and tag each one with a unique identifier. This approach not only highlights the accuracy of each prediction but also makes it easier to investigate specific cases, such as the outliers that caught our attention.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>top_2 <span class="ot">&lt;-</span> rf_predictions_tbl <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> abs_error, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(row_number)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>top_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  row_number
1         15
2         14</code></pre>
</div>
</div>
<p>We isolate the two predictions with the largest errors from the Random Forest model. This helps us focus on understanding and addressing these significant discrepancies.</p>
<p>We update our test dataset by adding a new column that flags whether each row is one of the two specific cases we’re focusing on, identified by their row numbers 14 and 15. This step helps us easily track and analyze these key observations further.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">factor =</span> <span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We transform our test data into a longer format to facilitate a detailed comparison across different predictors against the total yield. This transformation lets each predictor appear as its own data point in the plot, making it easier to visualize relationships individually.</p>
<p>Using ggplot, we then plot these relationships, with each predictor getting its own panel thanks to the `facet_wrap` function. This setup uses different scales for the x-axis in each panel, allowing us to better see the spread of data points for predictors that vary widely in their ranges.</p>
<p>We highlight the two key observations previously flagged (rows 14 and 15) in red, contrasting them against the others in blue. This color distinction makes it straightforward to spot how these particular cases stand out in the context of each predictor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare long format data for plotting total yield against various predictors</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>long_test_data <span class="ot">&lt;-</span> test_data <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(Disaster, total_yield, factor),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"predictor"</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatter plots of total yield vs. each predictor with separate scales and color-coded points by error factor</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(long_test_data, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> total_yield, <span class="at">color =</span> factor)) <span class="sc">+</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Plot points with half transparency and medium size</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> predictor, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span>  <span class="co"># Create a panel for each predictor and allow independent x-axis scales</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span>  <span class="co"># Define custom colors for the 'factor' variable</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># Apply a minimalistic theme for a clean look</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predictor Value"</span>,  <span class="co"># Label the x-axis</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Yield"</span>,  <span class="co"># Label the y-axis</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Error Factor"</span>,  <span class="co"># Define the legend title</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Scatter Plot of Total Yield vs Predictors"</span>,  <span class="co"># Add the main title</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Points colored by error factor"</span>)  <span class="co"># Add a subtitle</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Stat_project_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 9: Analysis of total yield in relation to various predictors, with data points highlighted to show significant errors in prediction.</figcaption>
</figure>
</div>
</div>
</div>
<p>The scatter plot presents an interesting scenario: the two red points, signaling where our model’s predictions significantly missed the mark, aren’t outliers in the typical sense; they’re not at the extreme ends of our predictor values. Instead, these points are interspersed among the blue ones, which represent more accurate predictions.</p>
<p>This indicates that the prediction errors might not be due to the predictors’ extreme values but could arise from complex interactions within the data that our model isn’t accounting for. The errors may be the result of an atypical combination of predictor values or factors not included in our model.</p>
<p>While the red points don’t suggest a fundamental flaw in the Random Forest model—it remains effective for the majority of the data—they highlight specific instances where the model’s predictive capability falters. This isn’t a cause for alarm but rather an opportunity to understand the model’s limitations and improve its predictive accuracy, ensuring it performs well across all possible scenarios in the application.</p>
</section>
</section>
<section id="results-communication" class="level2">
<h2 class="anchored" data-anchor-id="results-communication">Results Communication</h2>
<p>Throughout this project, we have conducted an extensive exploration of how climate variability affects agricultural productivity, utilizing a Random Forest model due to its robust performance in preliminary assessments. This model has been meticulously evaluated, particularly for its predictive accuracy reflected in the lowest RMSE, MAPE, and MAE metrics. Our rigorous approach has involved a thorough investigation into points of significant deviation, revealing that the largest prediction errors were not due to outliers but potentially from complex interactions within the data, which our model may not fully capture.</p>
<p>The data exploration phase yielded several interesting insights, including the positive correlation between higher temperatures and raindays, which goes against typical expectations. Additionally, the nuanced relationships between various climate factors and economic indicators were uncovered, highlighting the complexity of the Sahel region’s agricultural dynamics.</p>
<p>The early stages of the project addressed data limitations by incorporating Mali’s data from mid-century onwards, expanding the dataset to improve the model’s generalizability. This strategic decision was pivotal in strengthening the dataset, enabling us to conduct more robust analyses and ensuring a broader context for our findings.</p>
<p>Moving forward, this project points towards several avenues for future research. There is room to explore beyond the current model, including refining the Random Forest algorithm or considering other modeling approaches that could capture the subtleties suggested by our outliers analysis. Further research could extend to integrating additional climate and socioeconomic factors, employing feature engineering to enhance model performance, or expanding the regional focus to develop a model that can predict agricultural productivity across broader climatic zones.</p>
<p>In conclusion, our project has provided valuable insights into the impact of climate factors on agricultural yield and highlighted the interconnectedness of these variables with economic measures. The work sets the stage for future research aimed at developing an even more nuanced understanding and predictive capability for agricultural productivity in the face of global climate change.</p>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li>World Bank. (2024). Agriculture, forestry, and fishing, value added (% of GDP)-Niger. Retrieved from <a href="https://data.worldbank.org/indicator/NV.AGR.TOTL.ZS?locations=NE" class="uri">https://data.worldbank.org/indicator/NV.AGR.TOTL.ZS?locations=NE</a></li>
</ul>
<!-- -->
<ul>
<li><p>World Bank. (2024). Agriculture, forestry, and fishing, value added (% of GDP)-Mali. Retrieved from <a href="https://data.worldbank.org/indicator/NV.AGR.TOTL.ZS?locations=ML" class="uri">https://data.worldbank.org/indicator/NV.AGR.TOTL.ZS?locations=ML</a></p></li>
<li><p>World Bank. (2024). Age dependency ratio (% of working-age population)-Mali. Retrieved from <a href="https://data.worldbank.org/indicator/SP.POP.DPND?locations=ML" class="uri">https://data.worldbank.org/indicator/SP.POP.DPND?locations=ML</a></p></li>
<li><p>World Bank. (2024). Age dependency ratio (% of working-age population)-Niger. Retrieved from <a href="https://data.worldbank.org/indicator/SP.POP.DPND?locations=NE" class="uri">https://data.worldbank.org/indicator/SP.POP.DPND?locations=NE</a></p></li>
<li><p>Harris, I., Osborn, T.J., Jones, P. et al.&nbsp;(2020). CRU TS Version 4: A high-resolution gridded multivariate climate dataset. Scientific Data, 7(1), 109. <a href="https://doi.org/10.1038/s41597-020-0453-3" class="uri">https://doi.org/10.1038/s41597-020-0453-3</a></p></li>
<li><p>Food and Agriculture Organization of the United Nations (FAO). (2023). Production / Crops and livestock products. Retrieved from <a href="https://www.fao.org/faostat/en/#data/QCL/metadata">https://www.fao.org/faostat/en/#data/QCL</a></p></li>
<li><p>EM-DAT, CRED / UCLouvain, Brussels, Belgium. (2024). EMDAT Public Table. Retrieved from <a href="https://doc.emdat.be/docs/data-structure-and-content/emdat-public-table/" class="uri">https://doc.emdat.be/docs/data-structure-and-content/emdat-public-table/</a></p></li>
</ul>
</section>
<section id="add-ons" class="level3">
<h3 class="anchored" data-anchor-id="add-ons">Add ons</h3>
<ul>
<li><p>Generate relevant custom function (tidying climate data)</p></li>
<li><p>Impute missing data through model recipe</p></li>
<li><p>Make use of a list column during analysis (Model selection and assessment)</p></li>
<li><p>Make a gihub repo</p></li>
<li><p>Extract data from list (unnesting prediction data from workflow_tbl)</p></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>